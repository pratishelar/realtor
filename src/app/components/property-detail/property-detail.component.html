
    <div class="container-fluid py-4 property-detail-page">
      <div *ngIf="loading" class="text-center py-5">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Loading property...</span>
        </div>
      </div>

      <div *ngIf="!loading && property" class="container">
        <section class="row g-3">
          <div class="col-12 col-lg-8">
            <div class="card p-0 mb-3 shadow-sm border-0 property-gallery overflow-hidden">
              <div class="row g-2">
                <div class="col-12" [class.col-md-8]="property.images && property.images.length > 1" [class.col-md-12]="!property.images || property.images.length <= 1">
                  <div class="gallery-main overflow-hidden rounded-3 border position-relative">
                    <img *ngIf="getOrderedImages(property).length > 0" [src]="selectedImage || getOrderedImages(property)[0]" [alt]="property.name || property.title" class="w-100 h-100" loading="lazy" decoding="async" (error)="onImageError($event)" (click)="openGallery(getOrderedImages(property), selectedImage || getOrderedImages(property)[0])" style="cursor: zoom-in;" />
                    <div *ngIf="getOrderedImages(property).length===0" class="bg-light d-flex align-items-center justify-content-center h-100">
                      <span class="text-muted">üì∑ No Image</span>
                    </div>
                  </div>
                </div>
                <div class="col-12 col-md-4" *ngIf="getOrderedImages(property).length > 1">
                  <div class="row g-2">
                    <div class="col-6" *ngFor="let image of getOrderedImages(property) | slice:1:5; let i = index">
                      <button class="btn p-0 border rounded-3 overflow-hidden w-100 thumb-btn" (click)="selectedImage = image; openGallery(getOrderedImages(property), image)" [class.border-dark]="selectedImage===image" type="button">
                        <img [src]="image" [alt]="property.name || property.title" class="w-100 h-100" loading="lazy" decoding="async" (error)="onImageError($event)" />
                      </button>
                    </div>
                    <div class="col-6" *ngIf="getOrderedImages(property).length > 5">
                      <button type="button" class="thumb-btn border rounded-3 bg-dark text-white d-flex align-items-center justify-content-center h-100 w-100" (click)="openGallery(getOrderedImages(property))">+{{ getOrderedImages(property).length - 5 }} Photos</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="card shadow-sm p-4 mb-4">
              <h3 class="h5 mb-3">About this Property</h3>
              <p class="mb-0">{{ property.description }}</p>
            </div>

            <div class="card shadow-sm p-4 mb-4">
              <h3 class="h5 mb-3">Price List</h3>
              <div class="table-responsive">
                <table class="table table-sm mb-0 align-middle">
                  <thead>
                    <tr>
                      <th>Configuration</th>
                      <th class="text-end">Area (Sq.Ft.)</th>
                      <th class="text-end">Price</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let row of getPriceList(property)">
                      <td>{{ row.configuration }}</td>
                      <td class="text-end">{{ row.area | number:'1.0-0' }}</td>
                      <td class="text-end">‚Çπ{{ row.price | number }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="card shadow-sm p-4 mb-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="h5 mb-0">Floor Plans</h3>
                <a href="#" class="small text-decoration-none" (click)="$event.preventDefault()">View all</a>
              </div>
              <div class="row g-3">
                <div class="col-12 col-md-4" *ngFor="let plan of getFloorPlans(property)">
                  <div class="border rounded p-2 h-100">
                    <img [src]="plan.image" [alt]="plan.label" class="w-100 rounded mb-2" style="height: 120px; object-fit: cover;" loading="lazy" decoding="async" (error)="onImageError($event)" />
                    <div class="small fw-semibold">{{ plan.label }}</div>
                        <div class="small text-muted" *ngIf="plan.area > 0">{{ plan.area | number:'1.0-0' }} Sq.Ft.</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="card shadow-sm p-4 mt-4">
              <h3 class="h5 mb-3">Amenities</h3>
              <div class="row g-2 amenity-grid">
                <div class="col-6 col-md-2" *ngFor="let amenity of getAmenities(property)">
                  <div class="p-1 text-center h-100 d-flex flex-column align-items-center justify-content-center amenity-icon-box" [title]="amenity" [attr.aria-label]="amenity">
                    <span class="amenity-icon">{{ getAmenityIcon(amenity) }}</span>
                    <span class="amenity-label">{{ amenity }}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="card shadow-sm p-4 mt-4">
              <h3 class="h5 mb-3">RERA Details</h3>
              <div class="d-flex justify-content-between mb-2">
                <span>RERA Status</span>
                <strong class="text-success">{{ property.reraDetails.reraStatus || 'N/A' }}</strong>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span>RERA Number</span>
                <strong>{{ property.reraDetails.reraNumber || getReraNumber(property) }}</strong>
              </div>
              <div class="d-flex justify-content-between mb-0">
                <span>Possession</span>
                <strong>{{ property.reraDetails.possession || getDisplayStatus(property) }}</strong>
              </div>
            </div>

            <div class="card shadow-sm p-4 mt-4 mb-2">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="h5 mb-0">Similar Properties</h3>
                <a routerLink="/properties" class="small text-decoration-none">View all</a>
              </div>
              <div *ngIf="relatedProperties.length === 0" class="text-muted small">No similar listings available currently.</div>
              <div class="row g-3" *ngIf="relatedProperties.length > 0">
                <div class="col-12 col-md-6" *ngFor="let item of relatedProperties">
                  <div class="border rounded p-2 h-100">
                    <img *ngIf="getOrderedImages(item).length > 0" [src]="getOrderedImages(item)[0]" [alt]="item.name || item.title" class="w-100 rounded mb-2" style="height: 130px; object-fit: cover;" loading="lazy" decoding="async" (error)="onImageError($event)" />
                    <div class="fw-semibold small mb-1">{{ item.name || item.title }}</div>
                    <div class="small text-muted mb-1">{{ item.location }}{{ item.city ? ', ' + item.city : '' }}</div>
                    <div class="small text-primary fw-semibold">‚Çπ{{ getDisplayPrice(item) | number }}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-12 col-lg-4">
            <div class="card shadow-sm border p-0 mb-3 top-price-card">
              <div class="p-3 p-md-4 border-bottom">
                <h1 class="h4 mb-1 fw-bold">{{ property.name || property.title }}</h1>
                <div class="text-muted">{{ property.location }}{{ property.city ? ', ' + property.city : '' }}</div>
              </div>
              <div class="p-3 p-md-4 border-bottom">
                <div class="price-highlight d-flex align-items-center gap-2">
                  <span class="price-tag-icon" aria-hidden="true">üè∑Ô∏è</span>
                  <div class="price-highlight-text">
                    <span class="price-highlight-range">‚Çπ{{ getBasePrice(property) | number }}</span>
                    <button type="button" class="price-highlight-charges" (click)="openChargesPopup()">+ Charges</button>
                  </div>
                </div>
              </div>
              <div class="p-3 p-md-4 border-bottom d-flex justify-content-between align-items-center flex-wrap gap-2">
                <div>
                  <div class="text-muted">Project Status</div>
                  <div class="fs-5 fw-bold">{{ getProjectStatus(property) }}</div>
                </div>
              </div>
              <div class="p-3 p-md-4">
                <div class="unit-config-grid">
                  <div class="unit-config-item">
                    <div class="text-muted small">Unit Config</div>
                    <div class="fw-bold">{{ getUnitConfigLabel(property) }}</div>
                  </div>
                  <div class="unit-config-item">
                    <div class="text-muted small">Size</div>
                    <div class="fw-bold">{{ property.size.carpetArea | number:'1.0-0' }} to {{ property.size.totalArea | number:'1.0-0' }} Sq.Ft.</div>
                  </div>
                  <div class="unit-config-item">
                    <div class="text-muted small">Number of Units</div>
                    <div class="fw-bold">{{ property.numberOfUnits || 0 }}</div>
                  </div>
                  <div class="unit-config-item">
                    <div class="text-muted small">Total area</div>
                    <div class="fw-bold">{{ getTotalAreaInAcres(property) }} Acres</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="card shadow-sm p-3 p-md-4 mb-4 contact-seller-card">
              <div class="d-flex align-items-center gap-2 mb-3">
                <div class="contact-icon-circle">üìû</div>
                <h3 class="h4 fw-bold mb-0">Contact our Real Estate Experts</h3>
              </div>

              <form class="contact-expert-form" (ngSubmit)="submitExpertForm(property)">
                <div class="mb-3">
                  <input
                    type="text"
                    class="form-control contact-input"
                    placeholder="Name"
                    [(ngModel)]="expertForm.name"
                    name="expertName"
                    required
                  />
                </div>

                <div class="mb-3">
                  <input
                    type="email"
                    class="form-control contact-input"
                    placeholder="Email ID"
                    [(ngModel)]="expertForm.email"
                    name="expertEmail"
                    required
                  />
                </div>

                <div class="mb-4">
                  <div class="input-group phone-group">
                    <select class="form-select country-code" aria-label="Country code" [(ngModel)]="expertForm.countryCode" name="expertCountryCode">
                      <option value="+91" selected>+91</option>
                      <option value="+1">+1</option>
                      <option value="+44">+44</option>
                    </select>
                    <input
                      type="tel"
                      class="form-control contact-input"
                      placeholder="Phone Number"
                      [(ngModel)]="expertForm.phone"
                      name="expertPhone"
                      required
                    />
                  </div>
                </div>

                <button type="submit" class="btn btn-warning w-100 fw-bold py-3 contact-now-btn">Contact Now</button>
              </form>
            </div>
          </div>
        </section>
      </div>

      <div *ngIf="!loading && !property" class="text-center py-5">
        <h2>Property not found</h2>
        <p class="text-muted">It may have been removed or is unavailable.</p>
      </div>

      <div *ngIf="galleryOpen" class="position-fixed top-0 start-0 w-100 h-100 bg-dark bg-opacity-75 d-flex align-items-center justify-content-center" style="z-index: 2000;" (click)="closeGallery()">
        <div class="position-relative w-100 h-100 d-flex align-items-center justify-content-center p-3" (click)="$event.stopPropagation()">
          <button type="button" class="btn btn-light position-absolute top-0 end-0 m-3" (click)="closeGallery()">‚úï</button>

          <button type="button" class="btn btn-light position-absolute start-0 ms-2 ms-md-4" (click)="showPreviousImage()" *ngIf="galleryImages.length > 1">‚Äπ</button>

          <img
            *ngIf="galleryImages.length > 0"
            [src]="galleryImages[currentGalleryIndex]"
            alt="Gallery image"
            class="rounded"
            style="max-width: 95vw; max-height: 85vh; object-fit: contain;"
            decoding="async"
            (error)="onImageError($event)"
          />

          <button type="button" class="btn btn-light position-absolute end-0 me-2 me-md-4" (click)="showNextImage()" *ngIf="galleryImages.length > 1">‚Ä∫</button>

          <div class="position-absolute bottom-0 mb-3 text-white small" *ngIf="galleryImages.length > 0">
            {{ currentGalleryIndex + 1 }} / {{ galleryImages.length }}
          </div>
        </div>
      </div>

      <div *ngIf="chargesPopupOpen" class="charges-modal-backdrop" (click)="closeChargesPopup()">
        <div class="charges-modal-card" (click)="$event.stopPropagation()" role="dialog" aria-modal="true" aria-label="Applicable Government Charges">
          <div class="charges-modal-header">
            <h3 class="mb-0">Applicable Government Charges</h3>
            <button type="button" class="charges-modal-close" (click)="closeChargesPopup()" aria-label="Close">‚úï</button>
          </div>

          <div class="charges-modal-body">
            <h4 class="charges-modal-title">Government Charges</h4>
            <p class="charges-modal-subtitle mb-3">Standard across {{ property?.city || 'Pune' }}</p>

            <div class="charges-box mb-3">
              <div class="charges-box-head">Stamp Duty</div>
              <div class="charges-box-body">
                <ul class="charges-list mb-0">
                  <li>Male Ownership: 6 %</li>
                  <li>Female Ownership: 5 %</li>
                  <li>Joint Ownership: 5.5 %</li>
                </ul>
              </div>
            </div>

            <div class="charges-box">
              <div class="charges-box-head">Registration Charges</div>
              <div class="charges-box-body">
                <ul class="charges-list mb-0">
                  <li>1% of the total value</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  